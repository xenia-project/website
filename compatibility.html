---
layout: page
title: Compatibility
icon: insert_chart
permalink: /compatibility/
viewport_width: 675
---

<a href="https://github.com/xenia-project/game-compatibility/issues">Compatibility Tracker</a>
<br/>
If filing new issues, please follow the style of the existing ones (so this page works).
<br/>
<br/>
TODO: a fancy sortable/searchable table. <a href="https://github.com/benvanik/xenia/blob/gh-pages/compatibility.html">Want to help?</a>
<br/>
<br/>
<table id="issuesList" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
  <thead>
    <tr>
      <th>Title ID</th>
      <th class="mdl-data-table__cell--non-numeric">Name</th>
      <th>State</th>
      <th>Updated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="4" class="compatibility-progress">
        <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
      </td>
    </tr>
  </tbody>
</table>

<script src="{{ site.baseurl }}/scripts/merged-github-underscore.js"></script>

<script>
  var issueBlobString = localStorage.getItem('game-compatibility-issues');
  if (!issueBlobString) {
    // No cached data, fetch new.
    fetchIssueData(renderIssues);
  } else {
    var issueBlob = JSON.parse(issueBlobString);
    if (!issueBlob.cacheTime ||
        Date.now() - issueBlob.cacheTime > 5 * 60 * 1000) {
      // Expired - refetch.
      fetchIssueData(renderIssues);
    } else {
      // Cache is valid, draw.
      renderIssues(issueBlob.issueData);
    }
  }

  function fetchIssueData(callback) {
    var gh = new Github({});
    var issueAdapter = gh.getIssues('xenia-project', 'game-compatibility');
    issueAdapter.list({}, function(err, issueData) {
      // Store with timestamp for expiration.
      var issueBlob = {
        cacheTime: Date.now(),
        issueData: issueData
      };
      localStorage.setItem('game-compatibility-issues',
                           JSON.stringify(issueBlob));
      callback(issueData);
    });
  }

  function renderIssues(issueData) {
    // To see issue data:
    // console.log(issueData);

    var issuesList = document.getElementById('issuesList');
    var tbody = issuesList.getElementsByTagName('tbody')[0];
    for (var i = 0; i < issueData.length; ++i) {
      var issue = issueData[i];
      var dash = issue.title.indexOf(' - ');
      if (dash == -1) {
        continue;
      }
      var titleId = issue.title.substr(0, dash);
      var titleName = issue.title.substr(dash + 3);

      var marketplaceLink = 'https://www.google.com/?q=' + titleName + ' Xbox 360 game';
      var marketplaceBoxSmall = "http://i.imgur.com/G9iNSCA.jpg";
      // no large link appears to exist for this image
      var marketplaceBoxLarge = null;
      var marketplaceIndex = issue.body.search(/http[s]?:\/\/marketplace/);
      if (marketplaceIndex != -1) {
        marketplaceLink = issue.body.substr(marketplaceIndex);
        marketplaceLink = marketplaceLink.substr(0, marketplaceLink.search(/[\s)?"']/));
        var storeIdIndex = marketplaceLink.search(/[0-9a-f]{8}-[0-9a-f]{4}/);
        if (storeIdIndex != -1) {
          var storeId = marketplaceLink.substr(storeIdIndex);
          var marketplaceBox = 'http://download.xbox.com/content/images/' + storeId + '/1033/';
          marketplaceBoxSmall = marketplaceBox + 'boxartsm.jpg';
          marketplaceBoxLarge = marketplaceBox + 'boxartlg.jpg';
        } else {
          // TODO: figure out how to craft this ID.
          // storeId = '66acd000-77fe-1000-9115-d802' + titleId.toLowerCase();
        }
      }

      var tr = document.createElement('tr');
      tr.id = 'issue' + issue.id;
      tr.classList.add('compatibility-row');
      var td;
      td = document.createElement('td');
      td.id = tr.id + 'box';
      td.classList.add('compatibility-boxart');
      td.style.fontFamily = 'monospace';
      var marketplaceA = document.createElement('a');
      marketplaceA.href = marketplaceLink;
      marketplaceA.target = '_blank';
      if (marketplaceBoxSmall) {
        marketplaceA.innerHTML = '<img src="' + marketplaceBoxSmall + '">';
      }
      marketplaceA.innerHTML += '<span>' + titleId + '</span>';
      td.appendChild(marketplaceA);
      tr.appendChild(td);
      td = document.createElement('td');
      td.classList.add('mdl-data-table__cell--non-numeric');
      var issueA = document.createElement('a');
      issueA.href = issue.html_url;
      issueA.target = '_blank';
      issueA.innerHTML = titleName;
      td.appendChild(issueA);
      tr.appendChild(td);
      td = document.createElement('td');
      for (var j = 0; j < issue.labels.length; ++j) {
        var label = issue.labels[j];
        if (label.name.indexOf('state-') == 0) {
          td.innerHTML = label.name.substr(6);
          td.style.color = '#' + label.color;
        }
      }
      tr.appendChild(td);
      td = document.createElement('td');
      td.innerHTML = issue.updated_at.substr(0, issue.updated_at.indexOf('T'));
      tr.appendChild(td);
      tbody.appendChild(tr);

      /*var tooltip = document.createElement('span');
      tooltip.classList.add('mdl-tooltip');
      tooltip.classList.add('compatibility-tooltip');
      tooltip.setAttribute('for', tr.id + 'box');
      if (marketplaceBoxLarge) {
        tooltip.innerHTML = '<img src="' + marketplaceBoxLarge + '">';
      } else {
        tooltip.innerHTML = '(no art avail - misformatted issue?)';
      }
      componentHandler.upgradeElement(tooltip, 'MaterialTooltip');
      issuesList.appendChild(tooltip);*/
    }

    // Remove progress bar.
    tbody.removeChild(tbody.firstElementChild);
  }

</script>
